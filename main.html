<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Poker Room Demo</title>
    <style>
      body { font-family: system-ui, sans-serif; max-width: 700px; margin: 2rem auto; }
      label { display:block; margin:.5rem 0 .25rem; }
      input, select, button { padding:.5rem; }
      .row { display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
      pre { background:#f6f6f6; padding:1rem; border-radius:8px; }
      #error { color: red; font-weight: bold; margin-top: 1rem; }
      #success { color: green; font-weight: bold; margin-top: 1rem; }
    </style>
  </head>
  <body>
    <h1>Poker Room Demo</h1>

    <div class="row">
      <label>Room</label>
      <select id="room">
        <option value="1">Room 1</option>
        <option value="2">Room 2</option>
      </select>
    </div>

    <div class="row">
      <div>
        <label>Player ID</label>
        <input id="pid" placeholder="alice" />
      </div>
      <div>
        <label>Name</label>
        <input id="pname" placeholder="Alice" />
      </div>
      <div>
        <label>Stack</label>
        <input id="pstack" type="number" value="1000" />
      </div>
    </div>

    <div class="row" style="margin-top:.5rem">
      <button id="joinBtn">Join</button>
      <button id="leaveBtn">Leave</button>
      <button id="refreshBtn">Refresh Players</button>
    </div>

    <div id="error"></div>
    <div id="success"></div>

    <h3>Players</h3>
    <pre id="out">(none)</pre>

    <script>
      const API = "http://localhost:8080";
      const el = (id) => document.getElementById(id);

      function showError(msg) {
        el("error").textContent = msg;
        el("success").textContent = "";
      }

      function showSuccess(msg) {
        el("success").textContent = msg;
        el("error").textContent = "";
      }

      async function join() {
        const room = el("room").value;
        const body = {
          id: el("pid").value.trim(),
          name: el("pname").value.trim(),
          stack: Number(el("pstack").value)
        };
        if (!body.id || !body.name || !body.stack) {
          showError("Please fill id, name, stack (>0).");
          return;
        }

        const res = await fetch(`${API}/join?room=${room}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });

        const text = await res.text();
        if (!res.ok) {
          showError(`Error ${res.status}: ${text}`);
          el("out").textContent = "(none)";
        } else {
          showSuccess(text.trim());
          await refresh();
        }
      }

      async function leave() {
        const room = el("room").value;
        const body = { id: el("pid").value.trim() };
        if (!body.id) { showError("Enter the player id to leave."); return; }

        const res = await fetch(`${API}/leave?room=${room}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });

        const text = await res.text();
        if (!res.ok) {
          showError(`Error ${res.status}: ${text}`);
          el("out").textContent = "(none)";
        } else {
          showSuccess(text.trim());
          await refresh();
        }
      }

      async function refresh() {
        const room = el("room").value;
        try {
          const res = await fetch(`${API}/players?room=${room}`);
          if (!res.ok) {
            const text = await res.text();
            showError(`Error ${res.status}: ${text}`);
            el("out").textContent = "(none)";
            return;
          }
          const data = await res.json();
          el("out").textContent = JSON.stringify(data, null, 2);
          el("error").textContent = "";
        } catch (err) {
          showError(`Network error: ${err}`);
        }
      }

      el("joinBtn").onclick = join;
      el("leaveBtn").onclick = leave;
      el("refreshBtn").onclick = refresh;

      refresh(); // initial load
    </script>
  </body>
</html>
